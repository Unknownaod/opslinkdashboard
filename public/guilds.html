<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Your Servers • Discord Analytics</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background-image: radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 3px 3px;
    pointer-events: none;
    z-index: 0;
  }
</style>
</head>

<body class="relative bg-black text-white font-sans min-h-screen flex flex-col overflow-x-hidden">

<!-- NAVBAR -->
<nav class="relative z-10 flex items-center justify-between px-10 py-6 border-b border-white/10 backdrop-blur-xl bg-black/60">
  <span class="text-2xl font-bold tracking-tight">
    Discord Analytics
  </span>
  <a
    href="/api/logout"
    class="px-5 py-2 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20 transition text-sm font-medium"
  >
    Logout
  </a>
</nav>

<!-- MAIN -->
<main class="relative z-10 flex-1 px-10 py-14 max-w-7xl mx-auto w-full">

  <h1 class="text-4xl font-bold text-center mb-4">
    Your Servers
  </h1>
  <p id="status" class="text-center text-gray-400 mb-10">
    Loading your servers…
  </p>

  <!-- TABS -->
  <div class="flex justify-center gap-4 mb-12 flex-wrap">
    <button
      class="tab-btn px-6 py-2.5 rounded-xl bg-white text-black font-medium shadow-lg"
      data-tab="installed"
    >
      Bot Installed
    </button>
    <button
      class="tab-btn px-6 py-2.5 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20 transition font-medium"
      data-tab="not-installed"
    >
      Bot Not Installed
    </button>
    <button
      class="tab-btn px-6 py-2.5 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20 transition font-medium"
      data-tab="all"
    >
      All Servers
    </button>
  </div>

  <!-- SERVER LISTS -->
  <div id="installed" class="server-tab grid gap-8 sm:grid-cols-2 md:grid-cols-3 mb-12"></div>
  <div id="not-installed" class="server-tab grid gap-8 sm:grid-cols-2 md:grid-cols-3 mb-12 hidden"></div>
  <div id="all" class="server-tab grid gap-8 sm:grid-cols-2 md:grid-cols-3 mb-12 hidden"></div>
</main>

<!-- FOOTER -->
<footer class="relative z-10 border-t border-white/10 text-gray-400 text-center py-6 text-sm">
  © 2026 Discord Analytics
</footer>

<!-- SCRIPT -->
<script>
async function loadServers() {
  const status = document.getElementById("status");
  const installedList = document.getElementById("installed");
  const notInstalledList = document.getElementById("not-installed");
  const allList = document.getElementById("all");

  try {
    const res = await fetch("/api/guilds");
    if (res.status === 401) return window.location.href = "/";

    const { inBotAndUser, userNotInBot } = await res.json();
    status.remove();

    function createCard(guild, installed) {
      const card = document.createElement("div");
      card.className =
        "bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-8 flex flex-col items-center text-center shadow-xl hover:shadow-2xl hover:bg-white/10 transition-all";

      const icon = document.createElement("img");
      icon.src = guild.icon
        ? `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png?size=128`
        : "https://cdn.discordapp.com/embed/avatars/0.png";
      icon.alt = guild.name;
      icon.className =
        "h-24 w-24 rounded-full mb-5 border border-white/20";

      const name = document.createElement("h3");
      name.textContent = guild.name;
      name.className =
        "font-semibold text-lg mb-6 truncate max-w-xs";

      const button = document.createElement("a");
      button.className =
        "mt-auto w-full px-5 py-2.5 rounded-xl font-medium transition text-center";

      if (installed) {
        button.href = `/dashboard.html?guildId=${guild.id}`;
        button.textContent = "Open Dashboard";
        button.classList.add(
          "bg-white",
          "text-black",
          "hover:bg-gray-200",
          "shadow-lg"
        );
      } else {
        button.href =
          guild.addBotLink ||
          `https://discord.com/oauth2/authorize?client_id=1466430352238055587&scope=bot&permissions=8&guild_id=${guild.id}`;
        button.textContent = "Add Bot";
        button.classList.add(
          "bg-white/10",
          "border",
          "border-white/20",
          "hover:bg-white/20"
        );
      }

      card.append(icon, name, button);
      return card;
    }

    inBotAndUser.forEach(g =>
      installedList.appendChild(createCard(g, true))
    );

    userNotInBot.forEach(g =>
      notInstalledList.appendChild(createCard(g, false))
    );

    [...inBotAndUser, ...userNotInBot].forEach(g =>
      allList.appendChild(
        createCard(
          g,
          inBotAndUser.some(ig => ig.id === g.id)
        )
      )
    );
  } catch (err) {
    console.error(err);
    status.textContent = "Failed to load servers.";
  }
}

// Tabs
document.addEventListener("click", e => {
  if (!e.target.classList.contains("tab-btn")) return;

  const tab = e.target.dataset.tab;

  document.querySelectorAll(".server-tab").forEach(t =>
    t.classList.add("hidden")
  );
  document.getElementById(tab).classList.remove("hidden");

  document.querySelectorAll(".tab-btn").forEach(b => {
    b.className =
      "tab-btn px-6 py-2.5 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20 transition font-medium";
  });

  e.target.className =
    "tab-btn px-6 py-2.5 rounded-xl bg-white text-black font-medium shadow-lg";
});

loadServers();
</script>

</body>
</html>
